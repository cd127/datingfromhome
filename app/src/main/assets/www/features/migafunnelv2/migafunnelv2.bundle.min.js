angular.module('starter').controller('Migafunnelv2ViewController',function($stateParams,$rootScope,Migafunnelv2,Customer,$scope,$state,Loader,Dialog,SB,$ionicModal,$ionicHistory,$http,Url,$cordovaOauth,AUTH_EVENTS,$ionicScrollDelegate,$location,$window,$translate,Application,HomepageLayout){$scope.is_loading=!0;Loader.show();$scope.page_title="Migafunnelv2";$scope.is_logged_in=Customer.isLoggedIn();$scope.status=!1;$scope.migamarketing={};$scope.customer_consent={};$scope.show_sub=!1;$scope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.is_logged_in=!0;$scope.loadConsent()});$scope.loadContent=function(){console.log("updatedd");Migafunnelv2.load($stateParams.value_id).success(function(data){$scope.page_title=data.page_title;$scope.description=data.description;$scope.status=data.status}).finally(function(){$scope.is_loading=!1})};$scope.toggleFunnel=function(){$scope.is_loading=!0;$scope.status=($scope.status)?!1:!0;Migafunnelv2.update($stateParams.value_id,$scope.status).success(function(data){}).finally(function(){$scope.is_loading=!1})};$scope.markettingloadContent=function(){Migafunnelv2.markettingload($stateParams.value_id).success(function(data){$scope.migamarketing=data;console.log($scope.migamarketing)}).error(function onError(data){Dialog.alert('Error',data.message,'OK')}).finally(function(){$scope.is_loading=!1;Loader.hide()});if($scope.is_logged_in==!0){$scope.loadConsent()}};$scope.loadConsent=function(){$scope.is_loading=!0;Loader.show();if($scope.is_logged_in==!0){Migafunnelv2.loadConsent(Customer.customer.id).success(function(data){$scope.customer_consent=data;if($scope.customer_consent.consent){if($scope.customer_consent.consent.consent_status==1){$scope.show_sub=!0}else{$scope.show_sub=!1}}}).error(function onError(data){Dialog.alert('Error',data.message,'OK')}).finally(function(){$scope.is_loading=!1;Loader.hide()})}};$scope.saveConsent=function(status){$scope.is_loading=!0;Loader.show();if($scope.is_logged_in==!0){Migafunnelv2.saveConsent($stateParams.value_id,Customer.customer.id,status).success(function(data){}).error(function onError(data){Dialog.alert('Error',data.message,'OK')}).finally(function(){$scope.goToAppHome();$scope.is_loading=!1;Loader.hide()})}
if($scope.is_logged_in==!0){$scope.loadConsent()}};$scope.updateConsent=function(status){$scope.is_loading=!0;Loader.show();if($scope.is_logged_in==!0){Migafunnelv2.updateConsent($stateParams.value_id,Customer.customer.id,status).success(function(data){}).error(function onError(data){Dialog.alert('Error',data.message,'OK')}).finally(function(){$scope.goToAppHome();$scope.is_loading=!1;Loader.hide()})}
if($scope.is_logged_in==!0){$scope.loadConsent()}};$scope.login=function(){Customer.loginModal($scope)};$scope.goToAppHome=function(){$state.go('home')};$scope.loadContent();$scope.markettingloadContent()});angular.module("starter").factory('Migafunnelv2',function($rootScope,$http,Url){var factory={};factory.value_id=null;factory.status=null;factory.load=function(value_id){if(!value_id)return;return $http({method:'GET',url:Url.get("migafunnelv2/mobile_view/load",{value_id:value_id}),cache:!1,responseType:'json'})};factory.update=function(value_id,status){if(!value_id)return;return $http({method:'GET',url:Url.get("migafunnelv2/mobile_view/update",{value_id:value_id,status:status}),cache:!1,responseType:'json'})};factory.markettingload=function(value_id){if(!value_id)return;return $http({method:'GET',url:Url.get("migafunnelv2/mobile_view/marketingload",{value_id:value_id}),cache:!1,responseType:'json'})};factory.loadConsent=function(customer_id){if(!customer_id)return;return $http({method:'GET',url:Url.get("migafunnelv2/mobile_view/loadconsent",{customer_id:customer_id}),cache:!1,responseType:'json'})};factory.saveConsent=function(value_id,customer_id,status){if(!customer_id)return;return $http({method:'GET',url:Url.get("migafunnelv2/mobile_view/savecustomerconsent",{customer_id:customer_id,value_id:value_id,status:status}),cache:!1,responseType:'json'})};factory.updateConsent=function(value_id,customer_id,status){if(!customer_id)return;return $http({method:'GET',url:Url.get("migafunnelv2/mobile_view/updatecustomerconsent",{customer_id:customer_id,value_id:value_id,status:status}),cache:!1,responseType:'json'})};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}","migafunnelv2")