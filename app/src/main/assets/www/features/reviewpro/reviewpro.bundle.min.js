angular.module('starter').controller('ReviewproController',function(Dialog,Loader,SB,Customer,$filter,Reviewpro,$scope,$rootScope,$state,$stateParams,$translate){$scope.value_id=Reviewpro.value_id=$stateParams.value_id;$scope.datas=[];$scope.is_logged_in=Customer.isLoggedIn();$scope.page_title='';$scope.starArray=[1,2,3,4,5];$scope.starSelectedValues=0;$scope.feedback=[];$scope.is_customer_submit=0;$scope.is_loading=!1;$scope.reviewsList=[];$scope.can_load_older_posts=!0;$scope.loadContent=function(){$scope.feedback.message='';$scope.reviewsList=[];Loader.show();$scope.is_loading=!0;Reviewpro.load($scope.reviewsList.length).then(function(data){Loader.hide();$scope.is_loading=!1;$scope.datas=data.data;$scope.page_title=data.page_title;$scope.is_customer_submit=data.is_customer_submit;$scope.reviewsList=data.reviewsList;$scope.can_load_older_posts=!!data.reviewsList.length},function(error){$scope.is_loading=!1;Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1);$scope.can_load_older_posts=!1}).then(function(){$scope.is_loading=!1;Loader.hide()})};$scope.loadContent();$scope.loadMore=function(){if(!$scope.reviewsList.length){return!1}
Reviewpro.load($scope.reviewsList.length).success(function(data){$scope.can_load_older_posts=!!data.reviewsList.length;$scope.reviewsList=$scope.reviewsList.concat(data.reviewsList);$rootScope.$broadcast("refreshPageSize")}).error(function(error){$scope.can_load_older_posts=!1;Dialog.alert("Error",error.message,"OK",-1,"reviewpro")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.starSelected=function(starSelectedValues){$scope.starSelectedValues=starSelectedValues}
$scope.saveFeedback=function(){$scope.feedback.star=$scope.starSelectedValues;Reviewpro.saveFeedback($scope.feedback).success(function(data){if($scope.datas.star_rating_enable==0&&$scope.datas.write_message_enable==1&&$scope.feedback.message==''){Dialog.alert($translate.instant("Error","reviewpro"),$translate.instant("Please enter a message!",'reviewpro'),$translate.instant("OK","reviewpro"),3000,"reviewpro");return!1}
Dialog.alert($translate.instant("Success","reviewpro"),$translate.instant("Thank you for your feedback!",'reviewpro'),$translate.instant("OK","reviewpro"),3000,"reviewpro");$scope.feedback=[];$scope.starSelectedValues=0;$scope.loadContent()}).error(function(error){Dialog.alert("Error",error.message,"OK",-1,"reviewpro")})}
$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.loadContent();$scope.is_logged_in=Customer.isLoggedIn()});$scope.login=function(){Customer.loginModal($scope)}
$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/reviewpro/assets/media/customer-placeholder.png"}};$scope.convertDate=function(date){return $filter("moment_calendar")(Date.parse(date))};$scope.convertReplyDate=function(date){return $filter("moment_calendar")(new Date(date))}});angular.module('starter').factory('Reviewpro',function(Application,Pages,Customer,$state,LinkService,$pwaRequest,$ionicPlatform,$session,Dialog,SB,$ionicPopup,$translate,$timeout){var factory={};factory.value_id=null;factory.setValueId=function(valueId){factory.value_id=valueId;return factory};factory.getValueId=function(){return factory.value_id};factory.onStart=function(){Application.loaded.then(function(){var reviewpro=_.find(Pages.getActivePages(),{code:'reviewpro'});if(!reviewpro){return}
factory.setValueId(reviewpro.value_id).loadSettings().then(function(success){var data=success.data;if(data.is_test_mode=='1'){localStorage.setItem('is_remind_me_later_'+Application.app_id,'');localStorage.setItem('is_remind_me_later_time'+Application.app_id,'');localStorage.setItem('reviewpro_installtion_time'+Application.app_id,'')}else{if(localStorage.getItem('is_remind_me_later_'+Application.app_id)===null){localStorage.setItem('is_remind_me_later_'+Application.app_id,'')}
if(localStorage.getItem('reviewpro_installtion_time'+Application.app_id)===null){localStorage.setItem('reviewpro_installtion_time'+Application.app_id,Date.now())}}
console.log('review Pro Data',data);var daysDifferenceInstall=factory.daysDifference(Date.now(),localStorage.getItem('reviewpro_installtion_time'+Application.app_id));console.log('daysDifferenceInstall',daysDifferenceInstall);if((daysDifferenceInstall<data.ask_after_days)&&data.is_test_mode=='0'){return!0}
$timeout(function(){if(data&&localStorage.getItem('is_remind_me_later_'+Application.app_id)==''){factory.popUP(data);return!0}
if(data&&localStorage.getItem('is_remind_me_later_'+Application.app_id)=='YES'){var daysDifference=factory.daysDifference(Date.now(),localStorage.getItem('is_remind_me_later_time'+Application.app_id));console.log('daysDifference',daysDifference);if(daysDifference>=data.remind_after_days){factory.popUP(data);return!0}}},300)}).catch(function(error){console.error('reviewpro-error',error)})})};factory.daysDifference=function(timestamp1,timestamp2){var difference=timestamp1-timestamp2;var daysDifference=Math.floor(difference/(1000*60*60*24));return daysDifference}
factory.popUP=function(data){$ionicPopup.show({template:data.play_store_message,title:data.play_store_heading,cssClass:'reviewpro reviewpro-popup-layout1',buttons:[{text:$translate.instant("Remind me later","reviewpro"),type:'button button-light button-light-custom',onTap:function(e){localStorage.setItem('is_remind_me_later_'+Application.app_id,'YES');localStorage.setItem('is_remind_me_later_time'+Application.app_id,Date.now())}},{text:$translate.instant("Review Now","reviewpro"),type:'button button-positive button-positive-custom',onTap:function(e){localStorage.setItem('is_remind_me_later_'+Application.app_id,'ALREADYDONE');if(DEVICE_TYPE===SB.DEVICE.TYPE_BROWSER){if(data.androidURL!=''){LinkService.openLink(data.androidURL,{},!1);return!0}
if(data.iosURL!=''){LinkService.openLink(data.iosURL,{},!0);return!0}}
if(cordova&&cordova.plugins&&cordova.plugins.browsertab){if(ionic.Platform.isIOS()){cordova.plugins.browsertab.openUrl(data.iosURL,{})}
if(ionic.Platform.isAndroid()){cordova.plugins.browsertab.openUrl(data.androidURL,{})}}else{console.error("Plugin BrowserTab is missing.")}
return!0}}]})};factory.load=function(offset){return $pwaRequest.post('reviewpro/mobile_view/find',{data:{value_id:factory.value_id,offset:offset}})};factory.loadSettings=function(){return $pwaRequest.post('reviewpro/mobile_view/find-settings',{data:{value_id:factory.value_id}})};factory.saveFeedback=function(values){return $pwaRequest.post('reviewpro/mobile_view/save-feedback',{data:{value_id:factory.value_id,star:values.star,message:values.message,}})};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.reviewpro .item{border:none}.reviewpro h1.title{text-align:center}.reviewpro h1.title{text-align:center}.reviewpro .row.ion-star-row{font-size:36px}.reviewpro .feedback-message{border:1px solid #f3f3f3}.reviewpro . feedback-thankyou{margin-top:20%}.reviewpro .reatings-and-reviews-body{padding:0 16px}.reviewpro .reatings-and-reviews-body p{margin-top:0;margin-bottom:0}.reviewpro .reatings-and-reviews-body .row.ion-star-row{font-size:18px;padding-left:20%}.reviewpro .reatings-and-reviews-body .row.ion-star-row .ion-star-col{padding-left:10px}.reviewpro .item.item-reviewpro-reply h2{margin-bottom:0}.reviewpro .item.item-reviewpro-reply{opacity:.5;padding:0 20%}","reviewpro")