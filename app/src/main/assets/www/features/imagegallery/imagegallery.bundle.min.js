angular.module('starter').factory('Imagegallery',function($pwaRequest){var factory={};factory.value_id=null;factory.deleteImage=function(id){return $pwaRequest.post('imagegallery/mobile_view/deleteimage',{data:{value_id:factory.value_id,id:id},cache:!1,refresh:!0})};factory.findAll=function(params){return $pwaRequest.post('imagegallery/mobile_view/findall',{data:{value_id:factory.value_id},cache:!1,refresh:!0})};factory.changeStatus=function(params){return $pwaRequest.post('imagegallery/mobile_view/change-status',{data:{value_id:factory.value_id,id:params.id,is_public:params.is_public,},cache:!1,refresh:!0})};factory.SaveImageInfo=function(params){return $pwaRequest.post('imagegallery/mobile_view/saveimageinfo',{data:{uploading_image:params.uploading_image,comment:params.comment,is_public:params.is_public,value_id:factory.value_id},cache:!1,refresh:!0})};return factory});angular.module("starter").controller('ImagegalleryController',function($ionicModal,Dialog,Loader,SocialSharing,$cordovaCamera,$ionicPopup,$ionicModal,$rootScope,$scope,$state,$stateParams,$timeout,$translate,Application,$ionicActionSheet,Customer,Imagegallery){$scope.value_id=Imagegallery.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.is_logged_customer_id=Customer.id;$scope.is_loading=!0;$scope.is_public=1;$scope.images=[];$scope.gallery_images=[];$scope.customer_image=[];$scope.gallery_basePath=IMAGE_URL+'images/application/features/imagegallery/original/';$scope.addcontent=[];$scope.page_title='Gallery';$scope.loadContent=function(isflag){Loader.show();$scope.is_loading=!0;Imagegallery.findAll(Customer.id).then(function(payload){$timeout(function(){if(payload.success){$scope.page_title=payload.page_title;$scope.images.customer_image=payload.customerImage;$scope.images.gallery_images=payload.gallery_images;$scope.settings=payload.settings;$scope.phonebook_value_id=payload.phonebook_value_id;if($scope.settings.is_publish=='0'&&isflag){$scope.is_public=2}}else{$scope.images.customer_image=[];$scope.images.gallery_images=[]}},300)},function(error){Loader.hide();$scope.is_loading=!1;Dialog.alert("Error",error.message,"OK",-1,"imagegallery")}).then(function(){Loader.hide();$scope.is_loading=!1})}
$scope.loadContent(!0);$scope.tabContent=function(value){$scope.is_public=value}
$scope.reloadData=function(){$scope.loadContent(!1)}
$scope.viewDetails=function(values){Loader.show();$ionicModal.fromTemplateUrl('features/imagegallery/assets/templates/l1/Modal/details.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){Loader.hide();$scope.imageDetails=values;$scope.settings=$scope.settings;$scope.phonebook_value_id=$scope.phonebook_value_id;if($scope.imageDetails.is_public==1){$scope.imageDetails.is_public=!0}else{$scope.imageDetails.is_public=!1}
$scope.detailsModal=modal;$scope.detailsModal.show()})};$scope.closeDetailsModal=function(){$scope.detailsModal.hide()}
$scope.sharefile=function(imageURL){console.log("imageURL",imageURL);if(!Application.is_webview){SocialSharing.share(undefined,undefined,undefined,imageURL)}else{Dialog.alert("Error",'Not working in overview',"OK",-1,"imagegallery")}}
$scope.deletePhoto=function(id){$ionicPopup.show({title:$translate.instant('Delete'),template:$translate.instant('Are you sure want to delete?'),cssClass:'imagegallery-delete',scope:$scope,buttons:[{text:$translate.instant('Cancel'),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK'),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){Loader.show();$scope.is_submitting=!0;Imagegallery.deleteImage(id).then(function(payload){$scope.detailsModal.hide();$timeout(function(){document.getElementById("refresh-data").click();Loader.hide()},300)},function(error){Loader.hide();$scope.is_submitting=!1;Dialog.alert("Error",error.message,"OK",-1,"phonebook")})}})}
$scope.addPhoto=function(){if($scope.is_logged_in&&$scope.is_logged_customer_id>0){Loader.show();$ionicModal.fromTemplateUrl('features/imagegallery/assets/templates/l1/Modal/add.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){Loader.hide();$scope.addcontent={uploading_image:'',comment:'',is_public:!0};$scope.addModal=modal;$scope.addModal.show()})}else{Customer.loginModal($scope)}};$scope.closeAddModal=function(){$scope.addModal.hide()}
$scope.addPicture=function(){var gotImage=function(image_url){$scope.imageToSend=image_url;$ionicPopup.show({template:'<center><img ng-src="{{imageToSend}}" style="max-width: 100%; max-height: 100%;"></center>',cssClass:'classifieds no-title',scope:$scope,buttons:[{text:$translate.instant('Cancel'),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK'),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.addcontent.uploading_image=image_url}}).finally(function(){$scope.imageToSend=null})};var gotError=function(err){};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(evt){gotImage(evt.target.result);input.off("change",selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on("change",selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Take a picture")},{text:$translate.instant("Import from Library")}],cancelText:$translate.instant("Cancel"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage("data:image/jpeg;base64,"+imageData)},gotError);return!0}})}};$scope.SaveImageInfo=function(){Loader.show();$scope.is_submitting=!0;Imagegallery.SaveImageInfo($scope.addcontent).then(function(payload){$scope.addModal.hide();$timeout(function(){document.getElementById("refresh-data").click();Loader.hide()},300)},function(error){Loader.hide();$scope.is_submitting=!1;Dialog.alert("Error",error.message,"OK",-1,"phonebook")})}
$scope.formatDate=function(date){var dateOut=new Date(date);return dateOut};$scope.loginButton=function(){if(!Customer.isLoggedIn()){$scope.customer_passcode_active=!1;Customer.loginModal($scope,function(){$state.go('imagegallery_list',{value_id:$scope.value_id},{reload:!0})},function(){$state.go('imagegallery_list',{value_id:$scope.value_id},{reload:!0})},function(){$state.go('imagegallery_list',{value_id:$scope.value_id},{reload:!0})})}};$scope.toggleboxChange=function(){Loader.show();$scope.is_submitting=!0;Imagegallery.changeStatus($scope.imageDetails).then(function(payload){$timeout(function(){document.getElementById("refresh-data").click();Loader.hide();$scope.closeDetailsModal()},300)},function(error){Loader.hide();$scope.is_submitting=!1;Dialog.alert("Error",error.message,"OK",-1,"phonebook")})}
$scope.GoToPhonebook=function(customer_id){$scope.closeDetailsModal();$state.go("phonebook-info",{value_id:$scope.phonebook_value_id,friend_id:customer_id},{reload:!0})}});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}div#photos-grid_private,div#photos-grid_public{border:0}.tabs.image-gallery-tabs{top:44px!important;line-height:66px;border:0}.imagesallery-grid-img{width:100%;height:100%;object-fit:cover}","imagegallery")